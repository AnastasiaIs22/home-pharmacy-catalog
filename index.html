<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–î–æ–º–∞—à–Ω—è—è –∞–ø—Ç–µ–∫–∞</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      padding: 20px;
      color: #1a2e3f;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1.5fr;
      gap: 30px;
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    @media (max-width: 768px) {
      .container { grid-template-columns: 1fr; }
    }
    h1 {
      grid-column: 1 / -1;
      color: #0b3b5c;
      border-bottom: 3px solid #4fc3f7;
      padding-bottom: 15px;
      margin-bottom: 20px;
      font-size: 2.2em;
    }
    h2 {
      color: #2c5f7b;
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-section, .list-section {
      background: #f9fcff;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,79,112,0.08);
    }
    input, textarea, select {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 16px;
      border: 2px solid #e1eef6;
      border-radius: 12px;
      font-size: 1em;
      transition: 0.2s;
      background: white;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #4fc3f7;
      outline: none;
      box-shadow: 0 0 0 3px rgba(79,195,247,0.2);
    }
    button {
      background: #0b3b5c;
      color: white;
      padding: 14px 24px;
      border: none;
      border-radius: 40px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    button:hover {
      background: #0f4e73;
      transform: scale(1.02);
      box-shadow: 0 6px 14px rgba(11,59,92,0.25);
    }
    .delete-btn {
      background: #d32f2f;
      padding: 8px 16px;
      font-size: 0.9em;
      width: auto;
    }
    .delete-btn:hover { background: #b71c1c; }
    .edit-btn {
      background: #ff9800;
      padding: 8px 16px;
      font-size: 0.9em;
      width: auto;
    }
    .edit-btn:hover { background: #f57c00; }
    
    .medicine-card {
      background: white;
      padding: 18px;
      margin-bottom: 16px;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: 0.2s;
      border-left: 6px solid #4fc3f7;
    }
    .medicine-card.expired {
      border-left-color: #d32f2f;
      background: #ffebee;
    }
    .medicine-card.expires-soon {
      border-left-color: #ff9800;
      background: #fff3e0;
    }
    .medicine-card.expires-later {
      border-left-color: #4caf50;
      background: #e8f5e9;
    }
    .medicine-card:hover {
      box-shadow: 0 8px 18px rgba(0,79,112,0.12);
    }
    
    .medicine-info h3 {
      color: #0b3b5c;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .medicine-info p {
      color: #4a6a7c;
      margin-bottom: 4px;
    }
    .price {
      font-weight: 700;
      color: #1e6b3b;
      font-size: 1.2em;
    }
    
    .expiry-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: 600;
      margin-left: 8px;
    }
    .badge-expired {
      background: #d32f2f;
      color: white;
    }
    .badge-soon {
      background: #ff9800;
      color: white;
    }
    .badge-ok {
      background: #4caf50;
      color: white;
    }
    .badge-none {
      background: #9e9e9e;
      color: white;
    }
    
    .card-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .message {
      grid-column: 1 / -1;
      padding: 16px 24px;
      border-radius: 40px;
      display: none;
      font-weight: 500;
      text-align: center;
      animation: slideIn 0.3s;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .success { background: #c8e6c9; color: #1e3b2c; display: block; }
    .error { background: #ffcdd2; color: #8b1e1e; display: block; }
    
    .stats {
      grid-column: 1 / -1;
      display: flex;
      gap: 20px;
      justify-content: space-around;
      margin-top: 20px;
      padding: 20px;
      background: #e8f0fe;
      border-radius: 16px;
      flex-wrap: wrap;
    }
    .stat-item {
      text-align: center;
    }
    .stat-value {
      font-size: 2em;
      font-weight: 700;
      color: #0b3b5c;
    }
    
    .filter-section {
      grid-column: 1 / -1;
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .filter-btn {
      background: #e1eef6;
      color: #0b3b5c;
      padding: 8px 16px;
      width: auto;
      flex: 1 1 auto;
    }
    .filter-btn.active {
      background: #0b3b5c;
      color: white;
    }
    
    .footer {
      grid-column: 1 / -1;
      margin-top: 40px;
      padding: 30px 20px;
      background: linear-gradient(145deg, #f5faff, #eaf0f9);
      border-radius: 24px;
      border: 1px solid rgba(79, 195, 247, 0.2);
      color: #2c3e50;
    }
    
    .demo-badge {
      display: inline-block;
      background: #ff9800;
      color: white;
      padding: 6px 16px;
      border-radius: 40px;
      font-size: 0.85em;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: 16px;
      text-transform: uppercase;
    }
    
    .footer-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }
    
    @media (max-width: 768px) {
      .footer-content { grid-template-columns: 1fr; }
    }
    
    .footer-section h4 {
      color: #0b3b5c;
      margin-bottom: 16px;
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .footer-section p {
      color: #3a5a6e;
      line-height: 1.6;
      margin-bottom: 12px;
    }
    
    .tech-stack {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 16px;
    }
    
    .tech-item {
      background: white;
      padding: 6px 14px;
      border-radius: 40px;
      font-size: 0.9em;
      color: #0b3b5c;
      border: 1px solid #4fc3f7;
      box-shadow: 0 2px 6px rgba(0,0,0,0.02);
    }
    
    .account-info {
      background: rgba(11, 59, 92, 0.03);
      padding: 16px;
      border-radius: 16px;
      border-left: 4px solid #4fc3f7;
      margin-top: 12px;
    }
    
    .account-name {
      font-weight: 700;
      color: #0b3b5c;
      background: #e1eef6;
      padding: 2px 10px;
      border-radius: 20px;
      display: inline-block;
    }
    
    .footer-note {
      grid-column: 1 / -1;
      text-align: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px dashed #b0d4e8;
      color: #4a6a7c;
      font-size: 0.95em;
    }
    
    .user-info {
      grid-column: 1 / -1;
      background: #e3f2fd;
      padding: 16px 24px;
      border-radius: 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .auth-btn {
      background: #2e7d32;
      padding: 10px 24px;
      width: auto;
    }
    .logout-btn {
      background: #6c757d;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ–≥–æ QR-–±–ª–æ–∫–∞ */
    .qr-section {
      grid-column: 1 / -1;
      margin-top: 20px;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .qr-toggle {
      background: #0b3b5c;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 40px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: auto;
      margin-bottom: 15px;
      transition: 0.2s;
    }
    
    .qr-toggle:hover {
      background: #0f4e73;
      transform: scale(1.02);
    }
    
    .qr-container {
      display: none;
      background: white;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      border: 3px solid #0b3b5c;
      text-align: center;
      max-width: 300px;
      margin: 0 auto;
      animation: qrFadeIn 0.3s;
    }
    
    .qr-container.show {
      display: block;
    }
    
    .qr-container img {
      width: 180px;
      height: 180px;
      display: block;
      margin: 0 auto;
      border-radius: 8px;
    }
    
    .qr-title {
      margin: 12px 0 4px 0;
      font-size: 16px;
      color: #0b3b5c;
      font-weight: bold;
    }
    
    .qr-subtitle {
      margin: 4px 0;
      font-size: 14px;
      color: #4a6a7c;
    }
    
    .qr-link {
      margin: 8px 0 0 0;
      font-size: 11px;
      color: #6c757d;
      word-break: break-all;
      background: #f0f4f8;
      padding: 8px;
      border-radius: 8px;
    }
    
    @keyframes qrFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üè• –î–æ–º–∞—à–Ω—è—è –∞–ø—Ç–µ–∫–∞</h1>
    
    <!-- –ë–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="user-info">
      <span id="userStatus">üîí –ì–æ—Å—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø</span>
      <button id="authButton" class="auth-btn">üîë –í–æ–π—Ç–∏</button>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ä–æ–∫—É –≥–æ–¥–Ω–æ—Å—Ç–∏ -->
    <div class="filter-section">
      <button id="filterAll" class="filter-btn active">üìã –í—Å–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã</button>
      <button id="filterExpired" class="filter-btn">‚ùå –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</button>
      <button id="filterSoon" class="filter-btn">‚ö†Ô∏è –ò—Å—Ç–µ–∫–∞—é—Ç —Å–∫–æ—Ä–æ (‚â§10 –¥–Ω–µ–π)</button>
      <button id="filterGood" class="filter-btn">‚úÖ –ì–æ–¥–Ω—ã–µ</button>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="form-section">
      <h2>‚úèÔ∏è <span id="formTitle">–î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ</span></h2>
      <form id="medicineForm">
        <input type="hidden" id="editId">
        <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ *" required>
        <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ, –ø–æ–∫–∞–∑–∞–Ω–∏—è, –¥–æ–∑–∏—Ä–æ–≤–∫–∞" rows="3"></textarea>
        <input type="number" id="price" placeholder="–¶–µ–Ω–∞ (‚ÇΩ)" step="0.01">
        <input type="text" id="manufacturer" placeholder="–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å">
        <input type="date" id="expiryDate" placeholder="–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏">
        <button type="submit" id="submitBtn">
          <span>‚ûï</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
        </button>
        <button type="button" id="cancelEditBtn" style="background: #6c757d; display: none;">‚úñ –û—Ç–º–µ–Ω–∞</button>
      </form>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ª–µ–∫–∞—Ä—Å—Ç–≤ -->
    <div class="list-section">
      <h2>üìã –ú–æ—è –∞–ø—Ç–µ–∫–∞</h2>
      <div id="medicineList">
        <p style="color: #6c757d; text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="message" class="message"></div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats" id="stats">
      <div class="stat-item">
        <div class="stat-value" id="totalCount">0</div>
        <div>–í—Å–µ–≥–æ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="expiredCount">0</div>
        <div>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="soonCount">0</div>
        <div>–ò—Å—Ç–µ–∫–∞–µ—Ç —Å–∫–æ—Ä–æ</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="avgPrice">0</div>
        <div>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</div>
      </div>
    </div>

    <!-- ========== –°–í–û–†–ê–ß–ò–í–ê–ï–ú–´–ô QR-–ö–û–î ========== -->
    <div class="qr-section">
      <button id="qrToggleBtn" class="qr-toggle">
        <span>üì±</span> –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
      </button>
      
      <div id="qrContainer" class="qr-container">
        <img src="https://quickchart.io/qr?text=https://anastasiais22.github.io/Home-Pharmacy-Catalog/&size=200&margin=0&ecLevel=H&color=0b3b5c" alt="QR-–∫–æ–¥ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é">
        <p class="qr-title">üè• –î–ò–ü–õ–û–ú–ù–´–ô –ü–†–û–ï–ö–¢</p>
        <p class="qr-subtitle">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∫–∞–º–µ—Ä–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
        <p class="qr-link">https://anastasiais22.github.io/Home-Pharmacy-Catalog/</p>
        <p style="margin-top: 12px; font-size: 12px; color: #4a6a7c;">
          üîç –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        </p>
      </div>
    </div>

    <!-- –§–£–¢–ï–† —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–µ–∫—Ç–µ -->
    <div class="footer">
      <span class="demo-badge">üü° –î–ï–ú–û-–í–ï–†–°–ò–Ø</span>
      
      <div class="footer-content">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="footer-section">
          <h4>‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ</h4>
          <p>¬´–î–æ–º–∞—à–Ω—è—è –∞–ø—Ç–µ–∫–∞¬ª ‚Äî —ç—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É—á—ë—Ç–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –¥–∏–ø–ª–æ–º–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å—Ä–æ–∫–æ–≤ –≥–æ–¥–Ω–æ—Å—Ç–∏.</p>
          
          <div class="account-info">
            <p style="margin-bottom: 8px;">üîê <strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong></p>
            <p style="margin-bottom: 4px;">–û–±—ä–µ–∫—Ç–Ω–æ-—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –°–£–ë–î <strong style="color: #0b3b5c;">PostgreSQL</strong></p>
            <p>–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ –æ–±–ª–∞—á–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ <span class="account-name">AnastasiaIs22</span> –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Supabase.</p>
          </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="footer-section">
          <h4>‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫</h4>
          <div class="tech-stack">
            <span class="tech-item">HTML5 / CSS3</span>
            <span class="tech-item">JavaScript ES6+</span>
            <span class="tech-item">Supabase API</span>
            <span class="tech-item">PostgreSQL</span>
            <span class="tech-item">GitHub Pages</span>
            <span class="tech-item">OAuth 2.0</span>
          </div>
          
          <p style="margin-top: 24px;"><strong>üìå –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:</strong></p>
          <ul style="list-style-type: none; padding-left: 0; color: #3a5a6e;">
            <li style="margin-bottom: 8px;">‚úì –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</li>
            <li style="margin-bottom: 8px;">‚úì –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –≥–æ–¥–Ω–æ—Å—Ç–∏</li>
            <li style="margin-bottom: 8px;">‚úì –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏ (‚â§10 –¥–Ω–µ–π)</li>
            <li style="margin-bottom: 8px;">‚úì –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)</li>
            <li style="margin-bottom: 8px;">‚úì –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π QR-–∫–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</li>
          </ul>
        </div>
      </div>
      
      <!-- –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å —Ñ—É—Ç–µ—Ä–∞ -->
      <div class="footer-note">
        <p style="margin-bottom: 8px;">üü° –ù–∞—Å—Ç–æ—è—â–∏–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏.</p>
        <p style="margin-bottom: 8px;">–§—É–Ω–∫—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏.</p>
        <p style="color: #2c5f7b;">¬© 2026 ¬∑ –î–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–æ–µ–∫—Ç ¬∑ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Supabase (–∞–∫–∫–∞—É–Ω—Ç AnastasiaIs22)</p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
    const SUPABASE_URL = 'https://hocudyimgknwaitlsagk.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_vpdM56mSm1zukhIXNCPQkg_6vM9qxMH';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
    let currentUser = null;
    let editingId = null;
    let currentFilter = 'all';
    let allMedicines = [];

    // ========== –≠–õ–ï–ú–ï–ù–¢–´ DOM ==========
    const form = document.getElementById('medicineForm');
    const medicineList = document.getElementById('medicineList');
    const messageDiv = document.getElementById('message');
    const authButton = document.getElementById('authButton');
    const userStatus = document.getElementById('userStatus');
    const formTitle = document.getElementById('formTitle');
    const submitBtn = document.getElementById('submitBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    
    // ========== –≠–õ–ï–ú–ï–ù–¢–´ –î–õ–Ø QR-–ö–û–î–ê ==========
    const qrToggleBtn = document.getElementById('qrToggleBtn');
    const qrContainer = document.getElementById('qrContainer');

    // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø QR-–ö–û–î–ê ==========
    qrToggleBtn.addEventListener('click', function() {
      qrContainer.classList.toggle('show');
      if (qrContainer.classList.contains('show')) {
        qrToggleBtn.innerHTML = '<span>üì±</span> –°–∫—Ä—ã—Ç—å QR-–∫–æ–¥';
      } else {
        qrToggleBtn.innerHTML = '<span>üì±</span> –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏';
      }
    });

    // ========== –ü–†–û–í–ï–†–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ==========
    async function checkUser() {
      const { data: { user } } = await _supabase.auth.getUser();
      currentUser = user;
      
      if (user) {
        userStatus.innerHTML = `‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ${user.user_metadata?.user_name || '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}`;
        authButton.textContent = 'üö™ –í—ã–π—Ç–∏';
        authButton.classList.add('logout-btn');
        loadMedicines();
      } else {
        userStatus.innerHTML = 'üîí –ì–æ—Å—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø';
        authButton.textContent = 'üîë –í–æ–π—Ç–∏';
        authButton.classList.remove('logout-btn');
        loadMedicines();
      }
    }

    // ========== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==========
    async function handleAuth() {
      if (currentUser) {
        await _supabase.auth.signOut();
        currentUser = null;
        checkUser();
        showMessage('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
      } else {
        const { error } = await _supabase.auth.signInWithOAuth({
          provider: 'github',
          options: {
            redirectTo: window.location.origin + '/Home-Pharmacy-Catalog/'
          }
        });
        if (error) showMessage('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message, 'error');
      }
    }

    // ========== –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–¢–ê–¢–£–°–ê –°–†–û–ö–ê –ì–û–î–ù–û–°–¢–ò ==========
    function getExpiryStatus(expiryDate) {
      if (!expiryDate) return 'none';
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const expiry = new Date(expiryDate);
      expiry.setHours(0, 0, 0, 0);
      
      const diffTime = expiry - today;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays < 0) return 'expired';
      if (diffDays <= 10) return 'soon';
      return 'good';
    }

    // ========== –ó–ê–ì–†–£–ó–ö–ê –õ–ï–ö–ê–†–°–¢–í ==========
    async function loadMedicines() {
      try {
        const { data, error } = await _supabase
          .from('medicines')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) throw error;

        allMedicines = data || [];
        applyFilter();
        updateStats(allMedicines);
      } catch (error) {
        showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
        medicineList.innerHTML = '<p style="color: #d32f2f;">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</p>';
      }
    }

    // ========== –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –§–ò–õ–¨–¢–†–ê ==========
    function applyFilter() {
      let filtered = allMedicines;
      
      switch(currentFilter) {
        case 'expired':
          filtered = allMedicines.filter(m => getExpiryStatus(m.expiry_date) === 'expired');
          break;
        case 'soon':
          filtered = allMedicines.filter(m => getExpiryStatus(m.expiry_date) === 'soon');
          break;
        case 'good':
          filtered = allMedicines.filter(m => {
            const status = getExpiryStatus(m.expiry_date);
            return status === 'good' || status === 'none';
          });
          break;
        default:
          filtered = allMedicines;
      }
      
      displayMedicines(filtered);
    }

    // ========== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –õ–ï–ö–ê–†–°–¢–í ==========
    function displayMedicines(medicines) {
      if (medicines.length === 0) {
        medicineList.innerHTML = '<p style="color: #6c757d; text-align: center;">üì≠ –ù–µ—Ç –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>';
        return;
      }

      let html = '';
      medicines.forEach(med => {
        const expiryStatus = getExpiryStatus(med.expiry_date);
        let statusClass = '';
        let badgeHtml = '';
        
        switch(expiryStatus) {
          case 'expired':
            statusClass = 'expired';
            badgeHtml = '<span class="expiry-badge badge-expired">‚ùå –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>';
            break;
          case 'soon':
            statusClass = 'expires-soon';
            badgeHtml = '<span class="expiry-badge badge-soon">‚ö†Ô∏è –ò—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ ‚â§10 –¥–Ω–µ–π</span>';
            break;
          case 'good':
            statusClass = 'expires-later';
            badgeHtml = '<span class="expiry-badge badge-ok">‚úÖ –ì–æ–¥–µ–Ω</span>';
            break;
          default:
            badgeHtml = '<span class="expiry-badge badge-none">üìÖ –°—Ä–æ–∫ –Ω–µ —É–∫–∞–∑–∞–Ω</span>';
        }

        let expiryDisplay = '–ù–µ —É–∫–∞–∑–∞–Ω';
        if (med.expiry_date) {
          const date = new Date(med.expiry_date);
          expiryDisplay = date.toLocaleDateString('ru-RU');
        }

        html += `
          <div class="medicine-card ${statusClass}">
            <div class="medicine-info">
              <h3>
                ${escapeHtml(med.name)}
                ${badgeHtml}
              </h3>
              <p>${escapeHtml(med.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è')}</p>
              <p>üè≠ ${escapeHtml(med.manufacturer || '–ù–µ —É–∫–∞–∑–∞–Ω')}</p>
              <p>üìÖ –ì–æ–¥–µ–Ω –¥–æ: ${expiryDisplay}</p>
              <p class="price">üí∞ ${med.price ? Number(med.price).toFixed(2) + ' ‚ÇΩ' : '–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
            </div>
            <div class="card-actions">
              <button class="edit-btn" onclick="editMedicine('${med.id}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç.</button>
              <button class="delete-btn" onclick="deleteMedicine('${med.id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </div>
        `;
      });
      medicineList.innerHTML = html;
    }

    // ========== –≠–°–ö–ï–ô–ü–ò–ù–ì HTML ==========
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï / –û–ë–ù–û–í–õ–ï–ù–ò–ï ==========
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('name').value;
      const description = document.getElementById('description').value;
      const price = document.getElementById('price').value;
      const manufacturer = document.getElementById('manufacturer').value;
      const expiryDate = document.getElementById('expiryDate').value;
      const editId = document.getElementById('editId').value;

      const medicineData = {
        name,
        description: description || null,
        price: price ? parseFloat(price) : null,
        manufacturer: manufacturer || null,
        expiry_date: expiryDate || null
      };

      try {
        let result;
        if (editId) {
          result = await _supabase
            .from('medicines')
            .update(medicineData)
            .eq('id', editId);
          showMessage('‚úÖ –õ–µ–∫–∞—Ä—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
        } else {
          result = await _supabase
            .from('medicines')
            .insert([medicineData]);
          showMessage('‚úÖ –õ–µ–∫–∞—Ä—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!', 'success');
        }

        if (result.error) throw result.error;

        form.reset();
        document.getElementById('editId').value = '';
        editingId = null;
        formTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ';
        submitBtn.innerHTML = '<span>‚ûï</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
        cancelEditBtn.style.display = 'none';
        loadMedicines();
      } catch (error) {
        showMessage('–û—à–∏–±–∫–∞: ' + error.message, 'error');
      }
    });

    // ========== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï ==========
    window.editMedicine = async function(id) {
      try {
        const { data, error } = await _supabase
          .from('medicines')
          .select('*')
          .eq('id', id)
          .single();

        if (error) throw error;

        document.getElementById('editId').value = data.id;
        document.getElementById('name').value = data.name || '';
        document.getElementById('description').value = data.description || '';
        document.getElementById('price').value = data.price || '';
        document.getElementById('manufacturer').value = data.manufacturer || '';
        document.getElementById('expiryDate').value = data.expiry_date || '';
        
        formTitle.textContent = '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ';
        submitBtn.innerHTML = '<span>üíæ</span> –û–±–Ω–æ–≤–∏—Ç—å';
        cancelEditBtn.style.display = 'block';
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (error) {
        showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
      }
    };

    // ========== –û–¢–ú–ï–ù–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ==========
    cancelEditBtn.addEventListener('click', () => {
      form.reset();
      document.getElementById('editId').value = '';
      formTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ';
      submitBtn.innerHTML = '<span>‚ûï</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
      cancelEditBtn.style.display = 'none';
      showMessage('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ', 'success');
    });

    // ========== –£–î–ê–õ–ï–ù–ò–ï ==========
    window.deleteMedicine = async function(id) {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ–ø–∞—Ä–∞—Ç?')) return;

      try {
        const { error } = await _supabase
          .from('medicines')
          .delete()
          .eq('id', id);

        if (error) throw error;

        showMessage('üóëÔ∏è –õ–µ–∫–∞—Ä—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–æ', 'success');
        loadMedicines();
      } catch (error) {
        showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message, 'error');
      }
    };

    // ========== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ==========
    function updateStats(medicines) {
      const total = medicines.length;
      document.getElementById('totalCount').textContent = total;
      
      const expired = medicines.filter(m => getExpiryStatus(m.expiry_date) === 'expired').length;
      document.getElementById('expiredCount').textContent = expired;
      
      const soon = medicines.filter(m => getExpiryStatus(m.expiry_date) === 'soon').length;
      document.getElementById('soonCount').textContent = soon;

      const prices = medicines.filter(m => m.price).map(m => Number(m.price));
      const avg = prices.length 
        ? (prices.reduce((a, b) => a + b, 0) / prices.length).toFixed(2)
        : 0;
      document.getElementById('avgPrice').textContent = avg;
    }

    // ========== –°–û–û–ë–©–ï–ù–ò–Ø ==========
    function showMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = 'message ' + type;
      
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 5000);
    }

    // ========== –§–ò–õ–¨–¢–†–´ ==========
    document.getElementById('filterAll').addEventListener('click', function() {
      currentFilter = 'all';
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      applyFilter();
    });
    
    document.getElementById('filterExpired').addEventListener('click', function() {
      currentFilter = 'expired';
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      applyFilter();
    });
    
    document.getElementById('filterSoon').addEventListener('click', function() {
      currentFilter = 'soon';
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      applyFilter();
    });
    
    document.getElementById('filterGood').addEventListener('click', function() {
      currentFilter = 'good';
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      applyFilter();
    });

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    authButton.addEventListener('click', handleAuth);
    checkUser();

    _supabase.auth.onAuthStateChange((event, session) => {
      currentUser = session?.user || null;
      checkUser();
    });
  </script>
</body>
</html>
