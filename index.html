<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Pharmacy Catalog - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</title>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª—å */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3748;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-email {
            color: #4a5568;
            background: #f7fafc;
            padding: 8px 15px;
            border-radius: 20px;
        }

        .btn-logout {
            background: #fc8181;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #f56565;
        }

        /* –§–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #e2e8f0;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            background: none;
            border: none;
            font-size: 1.1em;
            cursor: pointer;
            color: #718096;
        }

        .auth-tab.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            margin-bottom: -2px;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #4a5568;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-primary {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .btn-add {
            background: #48bb78;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add:hover {
            background: #38a169;
        }

        .btn-edit {
            background: #4299e1;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
        }

        .btn-delete {
            background: #fc8181;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background: white;
            max-width: 500px;
            margin: 100px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
            color: #a0aec0;
        }

        .close:hover {
            color: #4a5568;
        }

        /* –¢–∞–±–ª–∏—Ü–∞ */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        tr:hover {
            background: #f7fafc;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="navbar">
            <div class="logo">üíä Home Pharmacy Catalog</div>
            <div class="user-menu" id="userMenu" style="display: none;">
                <span class="user-email" id="userEmail"></span>
                <button class="btn-logout" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <!-- –§–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–æ—à–µ–ª) -->
        <div id="authSection">
            <div class="auth-container">
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">–í—Ö–æ–¥</button>
                    <button class="auth-tab" onclick="switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>
                
                <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
                <div id="loginForm" class="auth-form active">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" placeholder="–≤–∞—à@email.com">
                    </div>
                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn-primary" onclick="login()">–í–æ–π—Ç–∏</button>
                </div>
                
                <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                <div id="registerForm" class="auth-form">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="registerEmail" placeholder="–≤–∞—à@email.com">
                    </div>
                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerPassword" placeholder="–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                    </div>
                    <button class="btn-primary" onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞) -->
        <div id="mainContent" style="display: none;">
            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div id="messageContainer"></div>
            
            <!-- –ü–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="actions-bar">
                <h2>üìã –ö–∞—Ç–∞–ª–æ–≥ –ª–µ–∫–∞—Ä—Å—Ç–≤</h2>
                <button class="btn-add" onclick="openAddModal()">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ
                </button>
            </div>

            <!-- –ü–æ–∏—Å–∫ -->
            <div class="search-box" style="margin-bottom: 20px;">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏..."
                    style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px;"
                    oninput="filterData(this.value)"
                >
            </div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ -->
            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr id="tableHeader">
                            <th>ID</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>–¶–µ–Ω–∞</th>
                            <th>–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</th>
                            <th>–í –Ω–∞–ª–∏—á–∏–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="8" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ</h3>
                    <span class="close" onclick="closeModal()">&times;</span>
                </div>
                <form id="medicineForm">
                    <input type="hidden" id="medicineId">
                    
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ *</label>
                        <input type="text" id="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <input type="text" id="category" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏">
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="number" id="quantity" min="0" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label>–¶–µ–Ω–∞ (—Ä—É–±.)</label>
                        <input type="number" id="price" step="0.01" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</label>
                        <input type="date" id="expiryDate">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="inStock" checked>
                            –í –Ω–∞–ª–∏—á–∏–∏
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-primary" onclick="saveMedicine(event)">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const SUPABASE_URL = 'https://hocudyimgknwaitlsagk.supabase.co';
        const SUPABASE_PUBLISHABLE_KEY = 'sb_publishable_vpdM56mSm1zukhIXNCPQkg_6vM9qxMH';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPUBASE_PUBLISHABLE_KEY);
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let allMedicines = [];

        // ============== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==============
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        async function checkSession() {
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                showMainContent();
                loadMedicines();
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            if (!email || !password) {
                showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                return;
            }
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                showMessage('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.', 'success');
                switchAuthTab('login');
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message, 'error');
            }
        }

        // –í—Ö–æ–¥
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                showMainContent();
                loadMedicines();
                showMessage('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message, 'error');
            }
        }

        // –í—ã—Ö–æ–¥
        async function logout() {
            try {
                await supabase.auth.signOut();
                currentUser = null;
                showAuthContent();
                showMessage('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ: ' + error.message, 'error');
            }
        }

        // ============== –†–ê–ë–û–¢–ê –° –î–ê–ù–ù–´–ú–ò ==============
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤
        async function loadMedicines() {
            try {
                const { data, error } = await supabase
                    .from('medicines')
                    .select('*')
                    .order('id', { ascending: true });
                
                if (error) throw error;
                
                allMedicines = data || [];
                renderTable(allMedicines);
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
        async function addMedicine(medicineData) {
            try {
                const { data, error } = await supabase
                    .from('medicines')
                    .insert([medicineData])
                    .select();
                
                if (error) throw error;
                
                showMessage('–õ–µ–∫–∞—Ä—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!', 'success');
                loadMedicines();
                closeModal();
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
        async function updateMedicine(id, medicineData) {
            try {
                const { data, error } = await supabase
                    .from('medicines')
                    .update(medicineData)
                    .eq('id', id)
                    .select();
                
                if (error) throw error;
                
                showMessage('–õ–µ–∫–∞—Ä—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
                loadMedicines();
                closeModal();
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
        async function deleteMedicine(id) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ?')) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('medicines')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                showMessage('–õ–µ–∫–∞—Ä—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                loadMedicines();
            } catch (error) {
                showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
        async function saveMedicine(event) {
            event.preventDefault();
            
            const medicineData = {
                name: document.getElementById('name').value,
                category: document.getElementById('category').value,
                quantity: parseInt(document.getElementById('quantity').value) || 0,
                price: parseFloat(document.getElementById('price').value) || 0,
                expiry_date: document.getElementById('expiryDate').value || null,
                in_stock: document.getElementById('inStock').checked,
                user_id: currentUser?.id,
                updated_at: new Date().toISOString()
            };
            
            const id = document.getElementById('medicineId').value;
            
            if (id) {
                await updateMedicine(id, medicineData);
            } else {
                medicineData.created_at = new Date().toISOString();
                await addMedicine(medicineData);
            }
        }

        // ============== –ò–ù–¢–ï–†–§–ï–ô–° ==============
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞)
        function showMainContent() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('userMenu').style.display = 'flex';
            document.getElementById('userEmail').textContent = currentUser?.email;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuthContent() {
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('userMenu').style.display = 'none';
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        function openAddModal() {
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ';
            document.getElementById('medicineForm').reset();
            document.getElementById('medicineId').value = '';
            document.getElementById('modal').style.display = 'block';
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function openEditModal(medicine) {
            document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–µ–∫–∞—Ä—Å—Ç–≤–æ';
            document.getElementById('medicineId').value = medicine.id;
            document.getElementById('name').value = medicine.name || '';
            document.getElementById('category').value = medicine.category || '';
            document.getElementById('quantity').value = medicine.quantity || 0;
            document.getElementById('price').value = medicine.price || 0;
            document.getElementById('expiryDate').value = medicine.expiry_date || '';
            document.getElementById('inStock').checked = medicine.in_stock !== false;
            document.getElementById('modal').style.display = 'block';
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        function filterData(searchTerm) {
            if (!searchTerm.trim()) {
                renderTable(allMedicines);
                return;
            }
            
            const term = searchTerm.toLowerCase();
            const filtered = allMedicines.filter(item => 
                (item.name?.toLowerCase().includes(term) ||
                item.category?.toLowerCase().includes(term))
            );
            renderTable(filtered);
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã
        function renderTable(medicines) {
            const tbody = document.getElementById('tableBody');
            
            if (!medicines || medicines.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            üì¶ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ!
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = medicines.map(med => `
                <tr>
                    <td>${med.id}</td>
                    <td><strong>${med.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong></td>
                    <td>${med.category || '‚Äî'}</td>
                    <td>${med.quantity || 0} —à—Ç</td>
                    <td>${med.price ? med.price.toFixed(2) + ' ‚ÇΩ' : '‚Äî'}</td>
                    <td>${med.expiry_date ? new Date(med.expiry_date).toLocaleDateString('ru-RU') : '‚Äî'}</td>
                    <td>${med.in_stock ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</td>
                    <td>
                        <button class="btn-edit" onclick='openEditModal(${JSON.stringify(med)})'>
                            ‚úèÔ∏è
                        </button>
                        <button class="btn-delete" onclick="deleteMedicine(${med.id})">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type) {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="${type}-message">${text}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            checkSession();
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_IN') {
                    currentUser = session.user;
                    showMainContent();
                    loadMedicines();
                } else if (event === 'SIGNED_OUT') {
                    currentUser = null;
                    showAuthContent();
                }
            });
        });
    </script>
</body>
</html>
